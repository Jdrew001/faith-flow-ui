<ion-header>
  <ion-toolbar>
    <ion-title>{{ session.title }}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="dismiss()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="session-detail-content">
  <!-- Session Header -->
  <div class="session-header">
    <div class="session-info">
      <div class="session-icon-large">
        <ion-icon [name]="getSessionTypeIcon(session.type)" color="primary"></ion-icon>
      </div>
      
      <div class="session-details">
        <h2 class="session-title">{{ session.title }}</h2>
        <p class="session-subtitle">{{ session.type }}</p>
        
        <div class="session-meta">
          <div class="meta-item">
            <ion-icon name="calendar" color="medium"></ion-icon>
            <span>{{ session.date | date:'fullDate' }}</span>
          </div>
          
          <div class="meta-item">
            <ion-icon name="time" color="medium"></ion-icon>
            <span>{{ formatTime(session.startTime) }} - {{ formatTime(session.endTime) }}</span>
          </div>
          
          <div class="meta-item" *ngIf="session.location">
            <ion-icon name="location" color="medium"></ion-icon>
            <span>{{ session.location }}</span>
          </div>
        </div>
        
        <ion-chip [color]="getStatusColor(session.status)" class="status-chip">
          <ion-icon [name]="getStatusIcon(session.status)"></ion-icon>
          <ion-label>{{ session.status | titlecase }}</ion-label>
        </ion-chip>
      </div>
    </div>

    <!-- Attendance Summary -->
    <div class="attendance-summary">
      <div class="summary-stat">
        <div class="stat-number">{{ session.totalExpected }}</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="summary-stat success">
        <div class="stat-number">{{ session.presentCount }}</div>
        <div class="stat-label">Present</div>
      </div>
      <div class="summary-stat danger">
        <div class="stat-number">{{ session.totalExpected - session.presentCount }}</div>
        <div class="stat-label">Absent</div>
      </div>
      <div class="summary-stat primary">
        <div class="stat-number">{{ session.attendanceRate }}%</div>
        <div class="stat-label">Rate</div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <ion-segment 
    [value]="selectedTab" 
    (ionChange)="onTabChange($event)"
    class="detail-segment">
    <ion-segment-button value="overview">
      <ion-label>Overview</ion-label>
    </ion-segment-button>
    <ion-segment-button value="attendance">
      <ion-label>Attendance</ion-label>
    </ion-segment-button>
    <ion-segment-button value="trends">
      <ion-label>Trends</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Tab Content -->
  <div class="tab-content">
    
    <!-- Overview Tab -->
    <div *ngIf="selectedTab === 'overview'" class="overview-tab">
      <ion-card class="info-card">
        <ion-card-header>
          <ion-card-title>Session Information</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="info-item" *ngIf="session.description">
            <strong>Description:</strong>
            <p>{{ session.description }}</p>
          </div>
          
          <div class="info-item">
            <strong>Duration:</strong>
            <p>{{ formatTime(session.startTime) }} - {{ formatTime(session.endTime) }}</p>
          </div>
          
          <div class="info-item" *ngIf="session.location">
            <strong>Location:</strong>
            <p>{{ session.location }}</p>
          </div>
          
          <div class="info-item">
            <strong>Type:</strong>
            <p>{{ session.type }}</p>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stats-card">
        <ion-card-header>
          <ion-card-title>Quick Stats</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="stats-grid">
            <div class="stat-item">
              <ion-icon name="people" color="primary"></ion-icon>
              <div class="stat-info">
                <div class="stat-value">{{ session.totalExpected }}</div>
                <div class="stat-label">Total Expected</div>
              </div>
            </div>
            
            <div class="stat-item">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <div class="stat-info">
                <div class="stat-value">{{ session.presentCount }}</div>
                <div class="stat-label">Present</div>
              </div>
            </div>
            
            <div class="stat-item">
              <ion-icon name="close-circle" color="danger"></ion-icon>
              <div class="stat-info">
                <div class="stat-value">{{ session.totalExpected - session.presentCount }}</div>
                <div class="stat-label">Absent</div>
              </div>
            </div>
            
            <div class="stat-item">
              <ion-icon name="trending-up" color="warning"></ion-icon>
              <div class="stat-info">
                <div class="stat-value">{{ session.attendanceRate }}%</div>
                <div class="stat-label">Attendance Rate</div>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Attendance Tab -->
    <div *ngIf="selectedTab === 'attendance'" class="attendance-tab">
      <div *ngIf="isLoading" class="loading-state">
        <ion-skeleton-text animated style="width: 100%; height: 60px; margin-bottom: 12px;" *ngFor="let item of [1,2,3,4,5]"></ion-skeleton-text>
      </div>

      <div *ngIf="!isLoading && attendanceRecords.length > 0" class="attendance-list">
        <ion-card *ngFor="let record of attendanceRecords; trackBy: trackByRecordId" class="attendance-record">
          <ion-card-content>
            <div class="record-content">
              <div class="person-info">
                <ion-avatar class="person-avatar">
                  <img src="https://gravatar.com/avatar/{{ record.personId }}?d=mp" alt="{{ record.personName }}">
                </ion-avatar>
                <div class="person-details">
                  <div class="person-name">{{ record.personName }}</div>
                  <div class="person-id">ID: {{ record.personId }}</div>
                </div>
              </div>

              <div class="attendance-status">
                <ion-chip 
                  [color]="record.status === 'Present' ? 'success' : 'danger'"
                  class="status-chip">
                  <ion-icon [name]="record.status === 'Present' ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                  <ion-label>{{ record.status }}</ion-label>
                </ion-chip>
              </div>

              <div class="record-actions">
                <ion-button 
                  fill="clear" 
                  size="small"
                  [color]="record.status === 'Present' ? 'danger' : 'success'"
                  (click)="markAttendance(record.personId, record.status === 'Present' ? 'Absent' : 'Present')">
                  <ion-icon 
                    [name]="record.status === 'Present' ? 'close-circle' : 'checkmark-circle'" 
                    slot="icon-only">
                  </ion-icon>
                </ion-button>
              </div>
            </div>

            <div *ngIf="record.notes" class="record-notes">
              <ion-note>{{ record.notes }}</ion-note>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <div *ngIf="!isLoading && attendanceRecords.length === 0" class="empty-attendance">
        <ion-card>
          <ion-card-content>
            <div class="empty-content">
              <ion-icon name="people" size="large" color="medium"></ion-icon>
              <h3>No Attendance Records</h3>
              <p>No attendance has been recorded for this session yet.</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Trends Tab -->
    <div *ngIf="selectedTab === 'trends'" class="trends-tab">
      <ion-card>
        <ion-card-content>
          <div class="trends-placeholder">
            <ion-icon name="analytics" size="large" color="medium"></ion-icon>
            <h3>Trends Analysis</h3>
            <p>Detailed attendance trends and analytics coming soon!</p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>

<ion-footer class="session-footer">
  <ion-toolbar>
    <div class="footer-actions">
      <ion-button fill="outline" (click)="dismiss()">
        Close
      </ion-button>
      <ion-button fill="solid" color="primary">
        <ion-icon name="checkmark-circle" slot="start"></ion-icon>
        Mark Attendance
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
