// Session Members - Clean & Functional Design

.session-members-modal {
  display: flex;
  flex-direction: column;
  height: 100%;
  position: relative;
  
  // CSS custom properties for dynamic header positioning
  --header-height: 160px; // Default: main + session info toolbars
  --quick-actions-height: 49px;
  
  .members-content {
    --background: #2c2c2e;
    --padding-start: 0;
    --padding-end: 0;
    --padding-top: 0; // Remove fixed padding, we'll handle this with sticky positioning
    min-height: 100vh;
    // Prevent any layout shifts during header transitions
    contain: layout style;
    transition: padding-top 0.3s ease-out;
  }
  
  &.header-hidden {
    .members-content {
      flex: 1;
      margin-top: 0;
    }
    
    .quick-actions-bar {
      top: 0; // Stick to very top when header is hidden
    }
    
    .search-filter-bar {
      top: var(--quick-actions-height); // Stack below quick actions bar
    }
  }
  
  // When header is visible, position sticky elements below it
  &:not(.header-hidden) {
    .quick-actions-bar {
      top: var(--header-height); // Position below header
    }
    
    .search-filter-bar {
      top: calc(var(--header-height) + var(--quick-actions-height)); // Header + quick actions bar height
    }
  }
  
  // When in selection mode, adjust for the extra toolbar
  &.selection-mode {
    --header-height: 164px; // Height with selection toolbar included
  }

  .members-content.has-sticky-actions {
    .search-filter-bar {
      top: 0 !important; // Stack below quick actions bar
    }

    .members-list-container {
      padding-top: 75px !important; // Adjust for sticky actions bar;
    }
  }
  
  ion-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    transform: translateY(0);
    transition: transform 0.3s ease-out;
    will-change: transform;
    pointer-events: auto; // Ensure header is interactive
    
    &.header-hidden {
      transform: translateY(-100%);
      pointer-events: none; // Disable interactions when hidden
    }
    
    ion-toolbar {
      --background: #3a3a3c;
      --color: #ffffff;
      --border-color: #48484a;
      
      ion-title {
        font-weight: 600;
        font-size: 18px;
      }
      
      ion-buttons {
        ion-button {
          --color: #ffffff;
        }
      }
    }
    
    .session-info-toolbar {
      --background: #2c2c2e;
      padding: 16px 0;
      border-bottom: 1px solid #48484a;
      
      .session-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 16px;
        
        .session-details {
          flex: 1;
          
          h3 {
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
          }
          
          .session-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            
            span {
              color: #8e8e93;
              font-size: 12px;
            }
          }
        }
        
        .attendance-stats-summary {
          .stat-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #34c759, #30d158);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            
            .rate {
              color: #ffffff;
              font-size: 16px;
              font-weight: 700;
            }
            
            .label {
              color: #ffffff;
              font-size: 10px;
              opacity: 0.8;
            }
          }
        }
      }
    }
  }
  
  .members-content {
    --background: #2c2c2e;
    --padding-start: 0;
    --padding-end: 0;
    padding-top: 200px; // Account for fixed header height (approximately)
    transition: padding-top 0.3s ease-out;
    min-height: 100vh;
    
    // When header is hidden, reduce top padding
    .header-hidden & {
      padding-top: 0;
    }
    
    // Ensure proper scrolling behavior
    ion-content {
      --overflow: visible;
      contain: none;
    }
    
    // Improve scroll performance on mobile
    -webkit-overflow-scrolling: touch;
    
    // Add extra bottom padding when bulk actions are visible
    &.has-sticky-actions {
      padding-bottom: 140px; // Height of sticky bulk actions
    }
  }
  
  // Selection Mode Toolbar
  .selection-toolbar {
    --background: var(--primary, #4a90e2);
    --color: #ffffff;
    
    ion-title {
      font-weight: 600;
      font-size: 16px;
    }
    
    ion-buttons {
      ion-button {
        --color: #ffffff;
        font-size: 12px;
      }
    }
  }
  
  // Quick Actions Bar
  .quick-actions-bar {
    background: #3a3a3c;
    padding: 8px 16px;
    border-bottom: 1px solid #48484a;
    position: sticky;
    z-index: 85; // Higher than search bar but lower than header
    transition: top 0.3s ease-out;
    
    .actions-container {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: space-around;
    }
    
    ion-button {
      --border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      flex: 1;
      min-width: 100px;
      max-width: 140px;
      
      ion-icon {
        font-size: 16px;
      }
    }
  }

  // Search & Filter Bar
  .search-filter-bar {
    padding: 16px;
    background: #2c2c2e;
    border-bottom: 1px solid #48484a;
    position: sticky;
    z-index: 90; // Higher than quick actions to ensure proper stacking
    margin-top: 0; // No additional margin since it follows the quick actions bar
    transition: top 0.3s ease-out;
    
    .member-searchbar {
      --background: #48484a;
      --color: #ffffff;
      --placeholder-color: #8e8e93;
      --icon-color: #8e8e93;
      --clear-button-color: #8e8e93;
      border-radius: 12px;
      margin-bottom: 12px;
      
      // Make sure it's visible
      opacity: 1;
      visibility: visible;
    }
    
    .filter-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      
      ion-button {
        --border-radius: 16px;
        font-size: 10px;
        font-weight: 600;
        min-width: auto;
        padding: 0 8px;
        height: 28px;
        
        &[fill="outline"] {
          --border-width: 1px;
        }
        
        // Ensure proper wrapping on smaller screens
        @media (max-width: 480px) {
          font-size: 9px;
          padding: 0 6px;
          height: 26px;
        }
      }
    }
  }
  
  // When header is hidden, reduce content padding
  &.header-hidden {
    .members-content {
      --padding-top: 0px;
    }
  }
  
  // Loading State
  .loading-state {
    text-align: center;
    padding: 60px 20px;
    color: #8e8e93;
    
    ion-spinner {
      --color: #007aff;
      margin-bottom: 16px;
    }
    
    p {
      font-size: 16px;
      margin: 0;
    }
  }
  
  // Members List Container
  .members-content.has-sticky-actions {

  }
  .members-list-container {
    flex: 1;
    min-height: 0; // Important for proper scrolling
    padding-top: 130px;
    position: relative;
    overflow-y: auto; // Enable scrolling for the container
    
    .members-list {
      padding: 8px 16px 100px; // Extra bottom padding for scrolling
      min-height: 100%;
    }
    
    .member-row {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: #3a3a3c;
      border-radius: 12px;
      margin-bottom: 8px;
      border: 1px solid #48484a;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      min-height: 70px; // Consistent height
      
      &:hover {
        background: #48484a;
        transform: translateX(2px);
      }
      
      &:active {
        transform: scale(0.98);
      }
      
      // Long press visual feedback
      &.long-press-feedback {
        transform: scale(0.95);
        background: rgba(74, 144, 226, 0.3);
        border-color: var(--primary, #4a90e2);
        box-shadow: 0 0 20px rgba(74, 144, 226, 0.4);
      }
      
      // Enhanced selection feedback
      &.selection-mode {
        &:not(.selected) {
          background: rgba(255, 255, 255, 0.02);
          border-color: rgba(255, 255, 255, 0.1);
        }
      }
      
      // Selection mode styling
      &.selection-mode {
        padding-left: 8px;
        
        &.selected {
          background: rgba(74, 144, 226, 0.2);
          border-color: var(--primary, #4a90e2);
          
          .status-indicator {
            background: var(--primary, #4a90e2);
          }
        }
      }
      
      // Long press active state
      &.has-long-press {
        background: rgba(74, 144, 226, 0.1);
        border-color: var(--primary, #4a90e2);
      }
      
      // Selection checkbox
      .member-selection {
        margin-right: 12px;
        
        ion-checkbox {
          --size: 20px;
          --checkbox-background-checked: var(--primary, #4a90e2);
          --border-color-checked: var(--primary, #4a90e2);
        }
      }
      
      .member-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        margin-right: 16px;
        overflow: hidden;
        flex-shrink: 0;
        
        .avatar-initials {
          width: 100%;
          height: 100%;
          background: linear-gradient(135deg, #007aff, #5ac8fa);
          display: flex;
          align-items: center;
          justify-content: center;
          color: #ffffff;
          font-size: 16px;
          font-weight: 600;
        }
        
        img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
      }
      
      .member-info {
        flex: 1;
        min-width: 0; // Prevent text overflow issues
        
        .member-name {
          color: #ffffff;
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 4px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }
        
        .member-status {
          display: flex;
          align-items: center;
          gap: 8px;
          
          ion-icon {
            font-size: 16px;
            flex-shrink: 0;
          }
          
          .status-text {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            flex-shrink: 0;
            
            &.present {
              color: #34c759;
            }
            
            &.absent {
              color: #ff453a;
            }
            
            &.late {
              color: #ff9500;
            }
            
            &.excused {
              color: #8e8e93;
            }
            
            &.unmarked {
              color: #8e8e93;
            }
          }
          
          .timestamp {
            color: #8e8e93;
            font-size: 11px;
            margin-left: auto;
            flex-shrink: 0;
          }
        }
      }
      
      .member-actions {
        flex-shrink: 0;
        margin-left: 8px;
        
        ion-button {
          --background: transparent;
          --box-shadow: none;
          --padding-start: 8px;
          --padding-end: 8px;
        }
      }
      
      // Status indicator (right border)
      .status-indicator {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 40%;
        border-radius: 2px 0 0 2px;
        
        &.present {
          background: #34c759;
        }
        
        &.absent {
          background: #ff453a;
        }
        
        &.late {
          background: #ff9500;
        }
        
        &.excused {
          background: #8e8e93;
        }
        
        &.unmarked {
          background: transparent;
        }
      }
    }
    
    // Empty State
    .empty-members {
      text-align: center;
      padding: 60px 20px;
      color: #8e8e93;
      
      .empty-icon {
        font-size: 64px;
        margin-bottom: 16px;
      }
      
      h3 {
        color: #ffffff;
        font-size: 18px;
        font-weight: 600;
        margin: 0 0 8px 0;
      }
      
      p {
        font-size: 14px;
        margin: 0;
        line-height: 1.4;
      }
    }
    
    // Bottom padding to ensure scrolling to last item (increased for sticky bottom bar)
    .bottom-padding {
      height: 160px; // Increased to account for sticky bottom bulk actions
      width: 100%;
    }
  }
  
  // Selection Hint Bar
  .selection-hint-bar {
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
    
    .hint-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      
      .hint-icon {
        color: rgba(255, 255, 255, 0.6);
        font-size: 16px;
      }
      
      .hint-text {
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        font-weight: 500;
      }
    }
  }
  
  // Sticky Bottom Bulk Actions Bar
  .sticky-bulk-actions {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #3a3a3c; // Same grey color as the top
    border-top: 1px solid #48484a;
    padding: 16px;
    z-index: 1000;
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(0);
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    
    // Animation for entering/leaving
    &.ng-enter {
      transform: translateY(100%);
    }
    
    &.ng-enter-active {
      transform: translateY(0);
    }
    
    .bulk-actions-container {
      max-width: 600px;
      margin: 0 auto;
      
      .bulk-actions-grid {
        .primary-actions {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
          margin-bottom: 12px;
          
          .action-button {
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            height: 56px;
            font-weight: 600;
            
            .button-content {
              display: flex;
              flex-direction: column;
              align-items: center;
              
              .action-label {
                font-size: 14px;
                line-height: 1.2;
              }
              
              .action-count {
                font-size: 11px;
                opacity: 0.9;
                margin-top: 2px;
              }
            }
            
            ion-icon {
              font-size: 20px;
              margin-right: 8px;
            }
          }
        }
        
        .secondary-actions {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 8px;
          
          .secondary-button {
            --border-radius: 8px;
            --border-width: 1.5px;
            height: 40px;
            font-size: 12px;
            font-weight: 600;
            
            ion-icon {
              font-size: 16px;
              margin-right: 6px;
            }
          }
        }
      }
    }
  }

  @keyframes slideUpIn {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
}

// Responsive Design
@media (min-width: 768px) {
  .session-members-modal {
    .filter-buttons {
      justify-content: center;
    }
    
    .members-list {
      max-width: 600px;
      margin: 0 auto;
    }
  }
}

// Action Sheet Styling (Global)
ion-action-sheet {
  .selected {
    font-weight: 700;
    color: var(--ion-color-primary) !important;
  }
}
