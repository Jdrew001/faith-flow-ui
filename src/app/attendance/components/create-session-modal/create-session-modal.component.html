<ion-header class="modal-header">
  <ion-toolbar>
    <ion-title>Create New Session</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="dismiss()" class="close-button">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="create-session-content" [scrollY]="true">
  <form [formGroup]="sessionForm" (ngSubmit)="createSession()">
    <div class="session-form">

      <!-- Session Details -->
      <div class="form-section fade-in">
        <h4 class="section-title">
          <ion-icon name="information-circle-outline" class="section-icon"></ion-icon>
          Session Details
        </h4>
        
        <!-- Session Name -->
        <div class="form-field" [class.error]="hasFieldError('name')" [class.has-value]="sessionForm.get('name')?.value">
          <div class="input-wrapper">
            <ion-icon name="text-outline" class="field-icon"></ion-icon>
            <input 
              type="text"
              formControlName="name"
              class="custom-input"
              id="session-name"
              required>
            <label for="session-name" class="floating-label">Session Name *</label>
          </div>
          <div class="error-message" *ngIf="hasFieldError('name')">
            <ion-icon name="alert-circle-outline"></ion-icon>
            {{ getFieldError('name') }}
          </div>
        </div>

        <!-- Description -->
        <div class="form-field" [class.has-value]="sessionForm.get('description')?.value">
          <div class="input-wrapper">
            <ion-icon name="document-text-outline" class="field-icon"></ion-icon>
            <textarea 
              formControlName="description"
              class="custom-textarea"
              id="session-description"
              rows="3"></textarea>
            <label for="session-description" class="floating-label">Description (Optional)</label>
          </div>
        </div>

        <!-- Date and Time -->
        <div class="datetime-section" [class.error]="hasFieldError('datetime')">
          <app-enhanced-date-picker
            formControlName="datetime"
            label="Date & Time"
            placeholder="Select date and time"
            mode="datetime"
          >
          </app-enhanced-date-picker>
          <div class="error-message" *ngIf="hasFieldError('datetime')">
            <ion-icon name="alert-circle-outline"></ion-icon>
            {{ getFieldError('datetime') }}
          </div>
        </div>

        <!-- Location -->
        <div class="form-field" [class.error]="hasFieldError('location')" [class.has-value]="sessionForm.get('location')?.value">
          <div class="input-wrapper">
            <ion-icon name="location-outline" class="field-icon"></ion-icon>
            <input 
              type="text"
              formControlName="location"
              class="custom-input"
              id="session-location"
              required>
            <label for="session-location" class="floating-label">Location *</label>
          </div>
          <div class="error-message" *ngIf="hasFieldError('location')">
            <ion-icon name="alert-circle-outline"></ion-icon>
            {{ getFieldError('location') }}
          </div>
        </div>

        <!-- Session Type -->
        <div class="form-field select-field">
          <div class="select-header">
            <ion-icon name="bookmark-outline" class="field-icon"></ion-icon>
            <ion-label class="select-label">Session Type</ion-label>
          </div>
          <app-custom-select
            formControlName="type"
            placeholder="Select session type"
            [options]="sessionTypeOptions">
          </app-custom-select>
        </div>

        <!-- Leader Assignment -->
        <div class="form-field" [class.has-value]="sessionForm.get('leader')?.value">
          <div class="input-wrapper">
            <ion-icon name="person-outline" class="field-icon"></ion-icon>
            <input 
              type="text"
              formControlName="leader"
              class="custom-input"
              id="session-leader">
            <label for="session-leader" class="floating-label">Session Leader (Optional)</label>
          </div>
        </div>
      </div>

      <!-- Occurrence Pattern -->
      <div class="form-section fade-in-delayed">
        <h4 class="section-title">
          <ion-icon name="repeat-outline" class="section-icon"></ion-icon>
          Occurrence Pattern
        </h4>
        <div class="occurrence-grid">
          <div 
            *ngFor="let option of occurrenceOptions; let i = index" 
            class="occurrence-card" 
            [class.selected]="sessionForm.get('occurrence')?.value === option.value"
            [style.animation-delay]="(i * 0.1) + 's'"
            (click)="selectOccurrence(option.value)">
            <div class="occurrence-content">
              <div class="occurrence-icon" [class.rotate]="sessionForm.get('occurrence')?.value === option.value">
                <ion-icon [name]="option.icon"></ion-icon>
              </div>
              <div class="occurrence-info">
                <div class="occurrence-label">{{ option.label }}</div>
                <div class="occurrence-description">{{ option.description }}</div>
              </div>
            </div>
            <div class="selection-indicator" *ngIf="sessionForm.get('occurrence')?.value === option.value">
              <ion-icon name="checkmark-circle" class="selection-icon"></ion-icon>
            </div>
          </div>
        </div>
      </div>

      <!-- Session Preview -->
      <div class="form-section preview-section fade-in-preview" *ngIf="sessionForm.get('name')?.value && sessionForm.get('datetime')?.value">
        <h4 class="section-title">
          <ion-icon name="eye-outline" class="section-icon"></ion-icon>
          Live Preview
        </h4>
        <div class="session-preview animated-card">
          <div class="preview-header">
            <div class="preview-icon pulse">
              <ion-icon [name]="getTypeIcon(sessionForm.get('type')?.value)"></ion-icon>
            </div>
            <div class="preview-info">
              <h5 class="preview-title">{{ sessionForm.get('name')?.value }}</h5>
              <p class="preview-type">
                <ion-icon name="bookmark"></ion-icon>
                {{ sessionForm.get('type')?.value | titlecase }} Session
              </p>
            </div>
            <div class="preview-badge">
              <span class="badge-text">New</span>
            </div>
          </div>
          
          <div class="preview-divider"></div>
          
          <div class="preview-details">
            <div class="preview-item slide-in">
              <div class="preview-item-icon">
                <ion-icon name="calendar"></ion-icon>
              </div>
              <div class="preview-item-content">
                <span class="preview-label">Date & Time</span>
                <span class="preview-value">{{ formatDateTime(sessionForm.get('datetime')?.value) }}</span>
              </div>
            </div>
            
            <div class="preview-item slide-in" *ngIf="sessionForm.get('location')?.value">
              <div class="preview-item-icon">
                <ion-icon name="location"></ion-icon>
              </div>
              <div class="preview-item-content">
                <span class="preview-label">Location</span>
                <span class="preview-value">{{ sessionForm.get('location')?.value }}</span>
              </div>
            </div>
            
            <div class="preview-item slide-in" *ngIf="sessionForm.get('leader')?.value">
              <div class="preview-item-icon">
                <ion-icon name="person"></ion-icon>
              </div>
              <div class="preview-item-content">
                <span class="preview-label">Session Leader</span>
                <span class="preview-value">{{ sessionForm.get('leader')?.value }}</span>
              </div>
            </div>
            
            <div class="preview-item slide-in">
              <div class="preview-item-icon">
                <ion-icon name="repeat"></ion-icon>
              </div>
              <div class="preview-item-content">
                <span class="preview-label">Recurrence</span>
                <span class="preview-value">{{ sessionForm.get('occurrence')?.value | titlecase }}</span>
              </div>
            </div>
          </div>
          
          <div class="preview-footer" *ngIf="sessionForm.get('description')?.value">
            <p class="preview-description">
              <ion-icon name="information-circle-outline"></ion-icon>
              {{ sessionForm.get('description')?.value }}
            </p>
          </div>
        </div>
      </div>

      <!-- Action Buttons - Inside scrollable content -->
      <div class="form-actions">
        <button 
          type="button"
          (click)="dismiss()"
          class="action-btn cancel-btn">
          <ion-icon name="close-circle-outline"></ion-icon>
          <span>Cancel</span>
        </button>
        
        <button 
          type="submit"
          [disabled]="!sessionForm.valid || isLoading"
          class="action-btn create-btn"
          [class.loading]="isLoading"
          (click)="createSession()">
          <div class="btn-content">
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <ion-icon name="add-circle" *ngIf="!isLoading"></ion-icon>
            <span>{{ isLoading ? 'Creating...' : 'Create Session' }}</span>
          </div>
          <div class="btn-ripple"></div>
        </button>
      </div>
      
      <!-- Bottom padding for safe scrolling -->
      <div class="bottom-padding"></div>
    </div>
  </form> 
</ion-content>
