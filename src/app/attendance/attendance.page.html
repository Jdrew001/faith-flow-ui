<div class="ion-page" id="main-content"
     appAutoHideHeader
     [scrollThreshold]="10"
     [hideDelay]="150"
     [showDelay]="50"
     (headerVisibilityChange)="onHeaderVisibilityChange($event)">
  <ion-header [translucent]="false" class="attendance-header" [class.header-hidden]="headerHidden">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button color="light"></ion-menu-button>
      </ion-buttons>
    </ion-toolbar>

    <!-- Welcome Banner Style Stats -->
    <div class="welcome-banner">
      <div class="banner-content">
        <h2>Attendance Tracking</h2>
        <p>Monitor and manage session attendance</p>
      </div>
      <div class="banner-stats">
        <div class="quick-stat">
          <span class="stat-number">{{ attendanceStats.totalSessions }}</span>
          <span class="stat-label">Sessions</span>
        </div>
        <div class="quick-stat primary">
          <span class="stat-number">{{ attendanceStats.attendanceRate }}%</span>
          <span class="stat-label">Rate</span>
        </div>
        <div class="quick-stat">
          <span class="stat-number">{{ attendanceStats.totalAttendees }}</span>
          <span class="stat-label">People</span>
        </div>
      </div>
    </div>
  </ion-header>

  <ion-content class="attendance-content">
    <!-- Pull to Refresh -->
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
      <ion-refresher-content
        pullingIcon="chevron-down-circle-outline"
        pullingText="Pull to refresh"
        refreshingSpinner="circles"
        refreshingText="Refreshing...">
      </ion-refresher-content>
    </ion-refresher>
    <!-- Time Filter Tabs -->
    <div class="time-filter-section">
      <ion-segment 
        [value]="selectedTimeFilter" 
        (ionChange)="onTimeFilterChange($event)"
        class="time-segment">
        <ion-segment-button value="today">
          <ion-label>Today</ion-label>
        </ion-segment-button>
        <ion-segment-button value="week">
          <ion-label>Week</ion-label>
        </ion-segment-button>
        <ion-segment-button value="month">
          <ion-label>Month</ion-label>
        </ion-segment-button>
      </ion-segment>

      <!-- Date Navigation -->
      <div class="date-navigation">
        <ion-button fill="clear" (click)="navigatePrevious()">
          <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
        </ion-button>
        <div class="current-date">{{ getCurrentDateLabel() }}</div>
        <ion-button fill="clear" (click)="navigateNext()">
          <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
      <ion-searchbar 
        [formControl]="searchControl"
        placeholder="Search sessions..."
        debounce="300"
        showClearButton="focus"
        class="session-searchbar">
      </ion-searchbar>
    </div>

    <!-- Session Cards -->
    <div class="sessions-container">
      <div *ngIf="isLoading" class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading sessions...</p>
      </div>

      <div *ngIf="!isLoading && filteredSessions.length > 0" class="session-cards">
        <div 
          *ngFor="let session of filteredSessions; trackBy: trackBySessionId"
          class="session-card"
          (click)="openSessionMembers(session)">
          
          <!-- Session Header -->
          <div class="session-header">
            <div class="session-main">
              <h3 class="session-title">{{ session.title }}</h3>
              <div class="session-type">
                <ion-icon [name]="getSessionTypeIcon(session.type)"></ion-icon>
                {{ getSessionTypeLabel(session.type) }}
              </div>
            </div>
            <div class="attendance-indicator" [class.good]="session.attendanceRate >= 75" [class.warning]="session.attendanceRate < 75 && session.attendanceRate >= 50" [class.low]="session.attendanceRate < 50">
              <span class="rate">{{ session.attendanceRate }}%</span>
            </div>
          </div>

          <!-- Session Details -->
          <div class="session-details">
            <div class="detail-item">
              <ion-icon name="calendar-outline"></ion-icon>
              {{ session.date | date:'EEE, MMM d' }}
            </div>
            <div class="detail-item">
              <ion-icon name="time-outline"></ion-icon>
              {{ session.startTime }}
            </div>
            <div class="detail-item">
              <ion-icon name="location-outline"></ion-icon>
              {{ session.location }}
            </div>
          </div>

          <!-- Attendance Bar -->
          <div class="attendance-bar">
            <div class="attendance-info">
              <span class="present">{{ session.presentCount }} present</span>
              <span class="absent">{{ session.totalExpected - session.presentCount }} absent</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="session.attendanceRate"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && filteredSessions.length === 0" class="empty-state">
        <div class="empty-content">
          <div class="empty-icon-wrapper">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <h3>No Sessions Found</h3>
          <p>There are no sessions for the selected time period</p>
          <div class="empty-actions">
            <ion-button (click)="clearAllFilters()" fill="clear" size="small">
              <ion-icon name="refresh-outline" slot="start"></ion-icon>
              Reset Filters
            </ion-button>
            <ion-button (click)="createNewSession()" fill="solid" size="small">
              <ion-icon name="add-outline" slot="start"></ion-icon>
              Create Session
            </ion-button>
          </div>
        </div>
      </div>
    </div>
  </ion-content>

  <!-- Floating Action Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" (click)="createNewSession()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</div>
