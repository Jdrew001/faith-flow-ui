
  <div class="ion-page" id="main-content">
      <ion-header [translucent]="false" class="dashboard-header">
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-menu-button color="light"></ion-menu-button>
          </ion-buttons>
          <ion-title>Dashboard</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="doRefresh(null)">
              <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
        
        <!-- Stats Bar -->
        <div class="stats-bar" *ngIf="currentUser$ | async as user">
          <div class="welcome-text">
            <span class="greeting">Hello, {{ user.firstName || 'User' }}</span>
            <span class="date">{{ getTodayDate() }}</span>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ getTotalMembers() }}</div>
            <div class="stat-label">Members</div>
          </div>
        </div>
      </ion-header>

      <ion-content class="dashboard-content">
        <!-- Pull to Refresh -->
        <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
          <ion-refresher-content
            pullingIcon="chevron-down-circle-outline"
            pullingText="Pull to refresh"
            refreshingSpinner="circles"
            refreshingText="Refreshing...">
          </ion-refresher-content>
        </ion-refresher>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            
            <!-- Attendance Overview Card -->
            <div class="dashboard-card attendance-card" (click)="onGoToAttendance()">
              <div class="card-header">
                <div class="card-icon">
                  <ion-icon name="people-outline"></ion-icon>
                </div>
                <div class="card-actions">
                  <div class="trend-indicator" [class.up]="attendanceStats.trend === 'up'" [class.down]="attendanceStats.trend === 'down'">
                    <ion-icon [name]="attendanceStats.trend === 'up' ? 'trending-up' : 'trending-down'"></ion-icon>
                    {{ attendanceStats.percentage }}%
                  </div>
                </div>
              </div>
              
              <div class="card-content">
                <h3 class="card-title">Weekly Attendance</h3>
                <div class="attendance-metrics" *ngIf="!isLoadingAttendance">
                  <div class="metric-row">
                    <div class="metric">
                      <span class="metric-value">{{ attendanceStats.present }}</span>
                      <span class="metric-label">Present</span>
                    </div>
                    <div class="metric">
                      <span class="metric-value">{{ attendanceStats.absent }}</span>
                      <span class="metric-label">Absent</span>
                    </div>
                  </div>
                  <div class="attendance-rate">
                    <div class="rate-bar">
                      <div class="rate-fill" [style.width.%]="attendanceStats.rate || 75"></div>
                    </div>
                    <span class="rate-text">{{ attendanceStats.rate || 75 }}% attendance rate</span>
                  </div>
                </div>
                <div class="loading-placeholder" *ngIf="isLoadingAttendance">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>
              </div>
            </div>

            <!-- Follow-Up Card -->
            <div class="dashboard-card followup-card">
              <div class="card-header">
                <div class="card-icon">
                  <ion-icon name="heart-outline"></ion-icon>
                </div>
                <div class="card-badge" *ngIf="followUpItems.length > 0">
                  {{ followUpItems.length }}
                </div>
              </div>
              
              <div class="card-content">
                <h3 class="card-title">Follow-ups Needed</h3>
                <div class="followup-list" *ngIf="!isLoadingFollowUps && followUpItems.length > 0">
                  <div class="followup-item" *ngFor="let item of followUpItems.slice(0, 3)" (click)="onViewFollowUp(item)">
                    <div class="followup-avatar" [class]="item.priority">
                      {{ item.name.charAt(0) }}
                    </div>
                    <div class="followup-info">
                      <span class="followup-name">{{ item.name }}</span>
                      <span class="followup-reason">{{ item.type }}</span>
                    </div>
                    <span class="followup-days">{{ item.daysAgo }}d</span>
                  </div>
                </div>
                <div class="empty-followups" *ngIf="!isLoadingFollowUps && followUpItems.length === 0">
                  <ion-icon name="checkmark-circle-outline"></ion-icon>
                  <p>All caught up!</p>
                </div>
                <div class="loading-placeholder" *ngIf="isLoadingFollowUps">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>
                <button class="view-all-btn" (click)="onViewAllFollowUps()">
                  View All Follow-ups
                  <ion-icon name="arrow-forward-outline"></ion-icon>
                </button>
              </div>
            </div>

            <!-- Upcoming Sessions Card -->
            <div class="dashboard-card sessions-card">
              <div class="card-header">
                <div class="card-icon">
                  <ion-icon name="calendar-outline"></ion-icon>
                </div>
              </div>
              
              <div class="card-content">
                <h3 class="card-title">Upcoming Sessions</h3>
                <div class="sessions-list" *ngIf="!isLoadingsessions && upcomingsessions.length > 0">
                  <div class="session-item" *ngFor="let event of upcomingsessions.slice(0, 3)">
                    <div class="session-date">
                      <span class="day">{{ getEventDay(event.date) }}</span>
                      <span class="month">{{ getEventMonth(event.date) }}</span>
                    </div>
                    <div class="session-info">
                      <span class="session-title">{{ event.title }}</span>
                      <span class="session-time">{{ event.time }}</span>
                    </div>
                    <ion-icon name="chevron-forward-outline" class="session-arrow"></ion-icon>
                  </div>
                </div>
                <div class="empty-sessions" *ngIf="!isLoadingsessions && upcomingsessions.length === 0">
                  <ion-icon name="calendar-clear-outline"></ion-icon>
                  <p>No upcoming sessions</p>
                </div>
                <div class="loading-placeholder" *ngIf="isLoadingsessions">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>
                <button class="view-all-btn" (click)="onGoToSessions()">
                  View Calendar
                  <ion-icon name="arrow-forward-outline"></ion-icon>
                </button>
              </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="dashboard-card stats-grid-card">
              <div class="card-header">
                <div class="card-icon">
                  <ion-icon name="analytics-outline"></ion-icon>
                </div>
              </div>
              
              <div class="card-content">
                <h3 class="card-title">Quick Stats</h3>
                <div class="stats-grid" *ngIf="!isLoadingMetrics">
                  <div class="stat-item" (click)="onViewReports()">
                    <ion-icon name="trending-up-outline" class="stat-icon up"></ion-icon>
                    <span class="stat-value">{{ getGrowthRate() }}%</span>
                    <span class="stat-label">Growth</span>
                  </div>
                  <div class="stat-item" (click)="onViewReports()">
                    <ion-icon name="time-outline" class="stat-icon"></ion-icon>
                    <span class="stat-value">{{ getAvgAttendance() }}</span>
                    <span class="stat-label">Avg Attendance</span>
                  </div>
                  <div class="stat-item" (click)="onViewWorkflows()">
                    <ion-icon name="git-branch-outline" class="stat-icon"></ion-icon>
                    <span class="stat-value">{{ workflowTriggers.count }}</span>
                    <span class="stat-label">Active Flows</span>
                  </div>
                  <div class="stat-item" (click)="onViewReports()">
                    <ion-icon name="person-add-outline" class="stat-icon"></ion-icon>
                    <span class="stat-value">{{ getNewMembers() }}</span>
                    <span class="stat-label">New Members</span>
                  </div>
                </div>
                <div class="loading-placeholder" *ngIf="isLoadingMetrics">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>
              </div>
            </div>

            <!-- Recent Activity Card -->
            <div class="dashboard-card activity-card">
              <div class="card-header">
                <div class="card-icon">
                  <ion-icon name="pulse-outline"></ion-icon>
                </div>
                <div class="card-actions">
                  <button class="icon-btn" (click)="refreshActivity()">
                    <ion-icon name="refresh-outline"></ion-icon>
                  </button>
                </div>
              </div>
              
              <div class="card-content">
                <h3 class="card-title">Recent Activity</h3>
                <div class="activity-list" *ngIf="!isLoadingActivity">
                  <div class="activity-item" *ngFor="let activity of recentActivities.slice(0, 4)">
                    <div class="activity-icon" [class]="activity.type">
                      <ion-icon [name]="getActivityIcon(activity.type)"></ion-icon>
                    </div>
                    <div class="activity-info">
                      <span class="activity-text">{{ activity.description }}</span>
                      <span class="activity-time">{{ formatActivityTime(activity.timestamp) }}</span>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder" *ngIf="isLoadingActivity">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>
              </div>
            </div>

        </div>
        <!-- End Dashboard Grid -->
      </ion-content>
  </div>